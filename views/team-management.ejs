<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Team</title>
</head>
<body>
    <h1>Manage Team: <%= team.team_name %></h1>
    <a href="/organizations/<%= orgId %>/members">Back to Organization</a>
    <hr>

    <h2>Assigned Inventories</h2>
    <% if (inventories.length > 0) { %>
        <ul>
            <% inventories.forEach(function(inventory, index) { %>
                <li>
                    <a href="/inventories/<%= inventory.inventory_id %>?teamId=<%= team.team_id %>"><%= inventory.inventory_name %></a>
                    
                    <% if (userIsAdmin) { %>
                        <button id="deleteBtn-<%= index %>" style="margin-left: 10px; color: red;">Delete</button>

                        <div id="confirmForm-<%= index %>" style="display:none; margin-top: 10px; border: 1px solid red; padding: 5px;">
                            <form action="/inventories/<%= inventory.inventory_id %>/delete" method="POST">
                                <input type="hidden" name="teamId" value="<%= team.team_id %>">
                                <label for="confirmation_name-<%= index %>">
                                    Type "<b><%= inventory.inventory_name %></b>" to confirm:
                                </label>
                                <input type="text" id="confirmation_name-<%= index %>" name="confirmation_name" required>
                                <button type="submit" style="color: red;">Delete</button>
                                <button type="button" id="cancelBtn-<%= index %>">Cancel</button>
                            </form>
                        </div>
                    <% } %>
                </li>
            <% }); %>
        </ul>
    <% } else { %>
        <p>This team has not been assigned any inventories yet.</p>
    <% } %>

    <hr>

    <% if (userIsAdmin) { %>
        <h2>Create New Inventory for this Team</h2>
        <form action="/teams/<%= team.team_id %>/inventories/create" method="POST">
            <input type="hidden" name="orgId" value="<%= orgId %>">
            <div>
                <label for="inventory_name">Inventory Name:</label>
                <input type="text" id="inventory_name" name="inventory_name" required>
            </div>
            <br>
            <button type="submit">Create Inventory</button>
        </form>
    <% } %>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            <% inventories.forEach(function(inventory, index) { %>
                // ‚≠ê FIX: Variable names are now unique using the index
                const deleteBtn_<%= index %> = document.getElementById('deleteBtn-<%= index %>');
                const cancelBtn_<%= index %> = document.getElementById('cancelBtn-<%= index %>');
                const confirmForm_<%= index %> = document.getElementById('confirmForm-<%= index %>');

                if (deleteBtn_<%= index %>) {
                    deleteBtn_<%= index %>.addEventListener('click', function() {
                        confirmForm_<%= index %>.style.display = 'block';
                        this.style.display = 'none';
                    });
                }
                
                if (cancelBtn_<%= index %>) {
                    cancelBtn_<%= index %>.addEventListener('click', function() {
                        confirmForm_<%= index %>.style.display = 'none';
                        deleteBtn_<%= index %>.style.display = 'inline';
                    });
                }
            <% }); %>
        });
    </script>
</body>
</html>